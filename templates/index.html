<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Suspect Analysis</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 20px;
      }
      .section {
        border: 1px solid #ccc;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 5px;
      }
      h2 {
        margin-top: 0;
      }
      pre {
        background-color: #f4f4f4;
        padding: 10px;
        border: 1px solid #ddd;
        overflow-x: auto;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type="file"] {
        margin-bottom: 10px;
      }
      button {
        padding: 8px 15px;
        cursor: pointer;
      }
      .result {
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <h1>Suspect Analysis System</h1>

    <!-- Emotion Analysis -->
    <div class="section">
      <h2>1. Emotion Analysis</h2>
      <form id="emotion-form" enctype="multipart/form-data">
        <label for="emotion-file">Upload Image:</label>
        <input
          type="file"
          id="emotion-file"
          name="file"
          accept="image/png, image/jpeg, image/jpg"
          required
        />
        <button type="submit">Analyze Emotion</button>
      </form>
      <div id="emotion-result" class="result"></div>
    </div>

    <!-- Identity Verification -->
    <div class="section">
      <h2>2. Identity Verification</h2>
      <form id="verify-form" enctype="multipart/form-data">
        <label for="verify-file1">Upload Image 1:</label>
        <input
          type="file"
          id="verify-file1"
          name="file1"
          accept="image/png, image/jpeg, image/jpg"
          required
        />
        <label for="verify-file2">Upload Image 2:</label>
        <input
          type="file"
          id="verify-file2"
          name="file2"
          accept="image/png, image/jpeg, image/jpg"
          required
        />
        <button type="submit">Verify Identity</button>
      </form>
      <div id="verify-result" class="result"></div>
    </div>

    <!-- Criminal Database Search -->
    <div class="section">
      <h2>3. Criminal Database Search</h2>
      <form id="find-form" enctype="multipart/form-data">
        <label for="find-file">Upload Suspect Image:</label>
        <input
          type="file"
          id="find-file"
          name="file"
          accept="image/png, image/jpeg, image/jpg"
          required
        />
        <button type="submit">Search Database</button>
      </form>
      <p>
        <small
          >Note: Compares against images in the server's
          <code>database</code> folder.</small
        >
      </p>
      <div id="find-result" class="result"></div>
    </div>

    <script>
      async function handleFormSubmit(event, endpoint, resultElementId) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const resultDiv = document.getElementById(resultElementId);
        resultDiv.innerHTML = "Processing..."; // Show loading indicator

        try {
          const response = await fetch(endpoint, {
            method: "POST",
            body: formData,
          });

          const result = await response.json();

          if (!response.ok) {
            // Display server-side error message
            resultDiv.innerHTML = `<p class="error">Error: ${
              result.error || "Unknown error"
            }</p>`;
          } else {
            // Display success result
            resultDiv.innerHTML = `<pre>${JSON.stringify(
              result,
              null,
              2
            )}</pre>`;
          }
        } catch (error) {
          console.error("Fetch Error:", error);
          resultDiv.innerHTML = `<p class="error">An error occurred while communicating with the server.</p>`;
        } finally {
          // Optionally reset the form after submission,
          // but might be annoying if user wants to re-submit slightly changed
          // form.reset();
        }
      }

      document
        .getElementById("emotion-form")
        .addEventListener("submit", (e) =>
          handleFormSubmit(e, "/analyze_emotion", "emotion-result")
        );
      document
        .getElementById("verify-form")
        .addEventListener("submit", (e) =>
          handleFormSubmit(e, "/verify_identity", "verify-result")
        );
      document
        .getElementById("find-form")
        .addEventListener("submit", (e) =>
          handleFormSubmit(e, "/find_suspect", "find-result")
        );
    </script>
  </body>
</html>
